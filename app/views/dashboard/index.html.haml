- nav_add 'Tablero', '#'
= nav_render4

%legend Desafíos de revisión

%table.challenges.table.table-striped.table-hover
  %thead
    %tr
      %th Progreso
      %th Título
      %th Vencimiento
      %th Estado
      %th Opcional
      %th Ejemplo de resolución
  %tbody
    - @challenges.each do |challenge|
      - progress = challenge.progress_by? current_user
      - percentage = (progress * 100).to_i
      %tr{class: "#{'finished' if percentage == 100} #{'missed' if percentage < 100 && !challenge.enabled}"}
        %td
          .progress{style: "height: 10px;"}
            .progress-bar.bg-success{"aria-valuemax" => "100", "aria-valuemin" => "0", role: "progressbar", style: "width: #{percentage}%;"}
          = percentage
          \%
        %td
          = link_to challenge.title, peer_review_challenge_path(challenge)
        %td
          = display_date challenge.due_date
        %td
          = challenge.enabled? ? "Vigente" : "Finalizado"
        %td
          = yes_no challenge.optional?
        %td
          = yes_no challenge.has_picked_solutions?

%hr

%legend Cuestionarios

%table.questionnaires.table.table-striped.table-hover
  %thead
    %tr
      %th Progreso
      %th Título
      %th &nbsp;
  %tbody
    - @questionnaires.each do |questionnaire|
      - progress = questionnaire.progress_by? current_user
      - percentage = (progress * 100).to_i
      %tr{class: "#{'finished' if percentage == 100}"}
        %td
          .progress{style: "height: 10px;"}
            .progress-bar.bg-success{"aria-valuemax" => "100", "aria-valuemin" => "0", role: "progressbar", style: "width: #{percentage}%;"}
          = percentage
          \%
        %td
          = questionnaire.name
        %td
          = link_to "Practicar", practice_multiple_choices_questionnaire_path(questionnaire), class: 'btn btn-primary btn-sm'
          - if questionnaire.solved_by? current_user
            = link_to "Revisar", last_multiple_choices_questionnaire_path(questionnaire), class: 'btn btn-secondary btn-sm'

= content_for :head do
  %link{href: "https://cdn.datatables.net/v/bs4/dt-1.10.21/datatables.min.css", rel: "stylesheet"}
  :css
    form.button_to {
      display: inline-block;
      margin: 0 0.1em;
    }

    tr.finished {
      background-color: #dff0d8 !important;
    }

    tr.finished:hover {
      background-color: #c6d7bf !important;
    }

    tr.missed {
      background-color: #f2dede !important;
    }

    tr.missed:hover {
      background-color: #d9c5c5 !important;
    }

= content_for :javascript do
  %script{src: "https://cdn.datatables.net/v/bs4/dt-1.10.21/datatables.min.js", type: "application/javascript"}
  :javascript
    $(function () {
      $('.challenges').DataTable({
        order: [[1, "asc"]],
        paging: false,
        language: {
          url: "https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
        },
        columnDefs: [{
          targets: 'no-sort',
          orderable: false
        }]
      });
      $('.questionnaires').DataTable({
        order: [[1, "asc"]],
        paging: false,
        language: {
          url: "https://cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
        },
        columnDefs: [{
          targets: 'no-sort',
          orderable: false
        }]
      });
    });
